<!doctype html>
<html>
    <head>
        <title>George's Squiggle Live Relay</title>
        <link rel="stylesheet" href="/assets/home.css" />
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body>
        <article>
            <h1>Squiggle Event Relay</h1>
            <h2>What is this?</h2>
            <p>
                <a href="https://squiggle.com.au">Squiggle</a> has a server-sent
                events endpoint for things like match scores. Unfortunately, the
                client limit is low and 429 errors are common.
            </p>
            <p>
                I've made this relay to allow apps that benefit from the
                real-time data but don't rely on it to access it without eating
                up the connection limit for everyone who actually needs it
            </p>

            <p>
                The server should be able to handle hundreds if not thousands of
                concurrent connections with no issue. There is no rate limit for
                now, that may change if people abuse this. Please don't retry
                immediately, use exponential back off.
            </p>
            <p>
                Connections will be culled at the server side if it receives no
                data for a minute. You can send a "ping" message to make sure
                this doesn't happen.
            </p>
            <p>
                I have included a simple JavaScript library that connects and
                subscribes to the events endpoint. It includes reconnects and
                keepalives.
            </p>
            <pre
                class="highlight"
            ><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">SquiggleRealtime</span> <span class="hljs-keyword">from</span> <span class="hljs-string"><script>document.write(JSON.stringify(new URL("/lib/squiggle_realtime.js", location)))</script></span>;

<span class="hljs-keyword">const</span> socket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SquiggleRealtime</span>(<span class="hljs-string" id="current_channel_snippet">"test"</span>);

socket.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"message"</span>, <span class="hljs-function">(<span class="hljs-params">{ detail }</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Received message"</span>, detail)
});</code></pre>
        </article>

        <template id="events">
            <aside>
                <div id="channel_selector"></div>
                <div id="event-list"></div></aside
        ></template>
        <script type="importmap">
            {
                "imports": {
                    "squiggle_realtime": "/lib/squiggle_realtime.js",
                    "squiggle_realtime/client_data": "/lib/client.js"
                }
            }
        </script>

        <script type="module">
            import "/assets/demo.js";
        </script>
    </body>
</html>
